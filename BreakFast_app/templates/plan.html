{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}BreakFast | Plan{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="icon" type="image/png" href="{% static 'images/bficon.png' %}">
<link rel="stylesheet" href="{% static 'css/tracker.css' %}">
<style>
    body {
        background: linear-gradient(rgba(255, 255, 255, 0.65), rgba(255, 255, 255, 0.65)), 
                    url("{% static 'images/waist.png' %}") no-repeat center center fixed !important;
        background-size: cover !important;
        min-height: 100vh;
        margin: 0;
        padding: 0;
    }

    .asteriskField {
        display: none;
    }

    .page-title {
        font-family: 'Arial', sans-serif;
        font-size: 2rem;
        font-weight: 600;
        letter-spacing: 0.05em;
        color: var(--dark-brown);
        text-align: center;
        margin-bottom: 2rem;
        text-transform: capitalize;
    }

    .section-title {
        font-family: 'Arial', sans-serif;
        font-size: 1.5rem;
        font-weight: 600;
        letter-spacing: 0.05em;
        color: var(--dark-brown);
        margin-bottom: 1.5rem;
        text-transform: capitalize;
    }

    .plan-card {
        background-color: rgba(229, 181, 181, 0.97) !important;
        backdrop-filter: blur(8px) !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        border-radius: 25px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .plan-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 20px rgba(0, 0, 0, 0.2);
    }

    .plan-title {
        font-size: 2rem;
        font-weight: 600;
        color: var(--dark-brown);
        margin-bottom: 1rem;
        text-align: center;
    }

    .plan-text {
        font-size: 1.1rem;
        color: var(--dark-brown);
        margin-bottom: 0.5rem;
        text-align: center;
    }

    .plan-rating {
        color: #FFD700;
        font-size: 1.2rem;
        margin-bottom: 1rem;
        text-align: center;
    }

    .btn-custom {
        background-color: var(--dark-brown) !important;
        color: white !important;
        border: none !important;
        padding: 0.75rem 1.5rem !important;
        border-radius: 15px !important;
        font-weight: 500 !important;
        transition: transform 0.2s ease, box-shadow 0.2s ease !important;
    }

    .btn-custom:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .btn-custom.active {
        background-color: #28a745 !important;
    }

    .custom-plan-form {
        background-color: rgba(229, 181, 181, 0.97) !important;
        backdrop-filter: blur(8px) !important;
        border: 1px solid rgba(255, 255, 255, 0.3) !important;
        border-radius: 25px;
        padding: 2rem;
    }

    .custom-plan-form label {
        color: var(--dark-brown);
        font-weight: 500;
    }

    .custom-plan-form .form-control {
        border: 1px solid rgba(74, 52, 52, 0.2);
        border-radius: 8px;
        padding: 0.5rem;
    }

    .custom-plan-form .form-control:focus {
        border-color: var(--dark-brown);
        box-shadow: 0 0 0 2px rgba(74, 52, 52, 0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="page-title">Choose Your Fasting Plan</h1>

    <!-- Preset Plans -->
    <section class="mb-5">
        <h2 class="section-title">Preset Plans</h2>
        <div class="row g-4">
            <!-- 16:8 Plan -->
            <div class="col-md-4">
                <div class="plan-card">
                    <h3 class="plan-title">16 | 8</h3>
                    <p class="plan-text">16 Hours Fasting</p>
                    <p class="plan-text">8 Hours Eating Window</p>
                    <div class="plan-rating">
                        <i class="fas fa-star"></i> 4.9
                    </div>
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="plan_type" value="16:8">
                        <input type="hidden" name="fasting_hours" value="16">
                        <input type="hidden" name="eating_hours" value="8">
                        <input type="hidden" name="name" value="16:8 Intermittent Fasting">
                        <input type="hidden" name="description" value="16 hours of fasting with an 8-hour eating window">
                        <button class="btn btn-custom w-100 {% if active_plan and active_plan.plan_type == '16:8' %}active{% endif %}">
                            {% if active_plan and active_plan.plan_type == '16:8' %}
                                <i class="fas fa-check me-2"></i>Active
                            {% else %}
                                Select
                            {% endif %}
                        </button>
                    </form>
                </div>
            </div>

            <!-- 18:6 Plan -->
            <div class="col-md-4">
                <div class="plan-card">
                    <h3 class="plan-title">18 | 6</h3>
                    <p class="plan-text">18 Hours Fasting</p>
                    <p class="plan-text">6 Hours Eating Window</p>
                    <div class="plan-rating">
                        <i class="fas fa-star"></i> 4.7
                    </div>
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="plan_type" value="18:6">
                        <input type="hidden" name="fasting_hours" value="18">
                        <input type="hidden" name="eating_hours" value="6">
                        <input type="hidden" name="name" value="18:6 Intermittent Fasting">
                        <input type="hidden" name="description" value="18 hours of fasting with a 6-hour eating window">
                        <button class="btn btn-custom w-100 {% if active_plan and active_plan.plan_type == '18:6' %}active{% endif %}">
                            {% if active_plan and active_plan.plan_type == '18:6' %}
                                <i class="fas fa-check me-2"></i>Active
                            {% else %}
                                Select
                            {% endif %}
                        </button>
                    </form>
                </div>
            </div>

            <!-- 20:4 Plan -->
            <div class="col-md-4">
                <div class="plan-card">
                    <h3 class="plan-title">20 | 4</h3>
                    <p class="plan-text">20 Hours Fasting</p>
                    <p class="plan-text">4 Hours Eating Window</p>
                    <div class="plan-rating">
                        <i class="fas fa-star"></i> 4.5
                    </div>
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="plan_type" value="20:4">
                        <input type="hidden" name="fasting_hours" value="20">
                        <input type="hidden" name="eating_hours" value="4">
                        <input type="hidden" name="name" value="20:4 Intermittent Fasting">
                        <input type="hidden" name="description" value="20 hours of fasting with a 4-hour eating window">
                        <button class="btn btn-custom w-100 {% if active_plan and active_plan.plan_type == '20:4' %}active{% endif %}">
                            {% if active_plan and active_plan.plan_type == '20:4' %}
                                <i class="fas fa-check me-2"></i>Active
                            {% else %}
                                Select
                            {% endif %}
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <!-- Custom Plan -->
    <section class="mb-5">
        <h2 class="section-title">Custom Plan</h2>
        <div class="custom-plan-form">
            <form method="post" class="row g-3">
                {% csrf_token %}
                {{ form|crispy }}
                <div class="col-12">
                    <button type="submit" class="btn btn-custom">
                        Create Custom Plan
                    </button>
                </div>
            </form>
        </div>
    </section>

    <!-- Current Plans -->
    <section>
        <h2 class="section-title">Your Plans</h2>
        {% if user_plans %}
        <div class="row g-4">
            {% for plan in user_plans %}
            <div class="col-md-4">
                <div class="plan-card">
                    <h3 class="plan-title">{{ plan.name }}</h3>
                    {% if plan.plan_type == '5:2' %}
                        <p class="plan-text">{{ plan.fasting_days }} Days Fasting</p>
                        <p class="plan-text">{{ plan.eating_days }} Days Eating</p>
                    {% else %}
                        <p class="plan-text">{{ plan.fasting_hours }} Hours Fasting</p>
                        <p class="plan-text">{{ plan.eating_hours }} Hours Eating</p>
                    {% endif %}
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="select_plan" value="{{ plan.id }}">
                        <button class="btn btn-custom w-100 {% if active_plan and active_plan.id == plan.id %}active{% endif %}">
                            {% if active_plan and active_plan.id == plan.id %}
                                <i class="fas fa-check me-2"></i>Active
                            {% else %}
                                Select
                            {% endif %}
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="plan-card text-center">
            <p class="plan-text">You haven't created any custom plans yet.</p>
        </div>
        {% endif %}
    </section>
</div>
{% endblock %}
