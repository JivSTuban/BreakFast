{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Plan{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<link rel="icon" type="image/png" href="{% static 'images/bficon.png' %}">
{% endblock %}

{% block content %}
<div class="container py-5" style="background-image: url('{% static 'images/waist.png' %}'); background-size: contain; background-position: right center; background-repeat: no-repeat;">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <h1 class="text-center mb-5" style="font-size: 2.5em; font-weight: bold; color: #d81b60;">CHOOSE YOUR FASTING PLAN!</h1>

            <!-- Preset Plans -->
            <section class="mb-5">
                <h2 class="h3 mb-4 text-primary">Preset Plans</h2>
                <div class="row g-4">
                    <!-- 16:8 Plan -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm" style="border-radius: 15px; transition: transform 0.3s ease;">
                            <div class="card-body text-center">
                                <h2 class="card-title mb-3" style="font-size: 2em; color: #d81b60;">16 | 8</h2>
                                <p class="card-text mb-2">16 Hours Fasting</p>
                                <p class="card-text mb-3">8 Hours Eating Window</p>
                                <div class="mb-3" style="color: #ffc107;">⭐ 4.9</div>
                                <form method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="plan_type" value="16:8">
                                    <input type="hidden" name="fasting_hours" value="16">
                                    <input type="hidden" name="eating_hours" value="8">
                                    <input type="hidden" name="name" value="16:8 Intermittent Fasting">
                                    <input type="hidden" name="description" value="16 hours of fasting with an 8-hour eating window">
                                    <button class="btn btn-primary w-100" style="background-color: #F3A9A8; border: none; transition: all 0.3s ease;">Select</button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- 18:6 Plan -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm" style="border-radius: 15px; transition: transform 0.3s ease;">
                            <div class="card-body text-center">
                                <h2 class="card-title mb-3" style="font-size: 2em; color: #d81b60;">18 | 6</h2>
                                <p class="card-text mb-2">18 Hours Fasting</p>
                                <p class="card-text mb-3">6 Hours Eating Window</p>
                                <div class="mb-3" style="color: #ffc107;">⭐ 4.7</div>
                                <form method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="plan_type" value="18:6">
                                    <input type="hidden" name="fasting_hours" value="18">
                                    <input type="hidden" name="eating_hours" value="6">
                                    <input type="hidden" name="name" value="18:6 Intermittent Fasting">
                                    <input type="hidden" name="description" value="18 hours of fasting with a 6-hour eating window">
                                    <button class="btn btn-primary w-100" style="background-color: #F3A9A8; border: none; transition: all 0.3s ease;">Select</button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- 20:4 Plan -->
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm" style="border-radius: 15px; transition: transform 0.3s ease;">
                            <div class="card-body text-center">
                                <h2 class="card-title mb-3" style="font-size: 2em; color: #d81b60;">20 | 4</h2>
                                <p class="card-text mb-2">20 Hours Fasting</p>
                                <p class="card-text mb-3">4 Hours Eating Window</p>
                                <div class="mb-3" style="color: #ffc107;">⭐ 4.5</div>
                                <form method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="plan_type" value="20:4">
                                    <input type="hidden" name="fasting_hours" value="20">
                                    <input type="hidden" name="eating_hours" value="4">
                                    <input type="hidden" name="name" value="20:4 Intermittent Fasting">
                                    <input type="hidden" name="description" value="20 hours of fasting with a 4-hour eating window">
                                    <button class="btn btn-primary w-100" style="background-color: #F3A9A8; border: none; transition: all 0.3s ease;">Select</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Custom Plan -->
            <section class="mb-5">
                <h2 class="h3 mb-4 text-primary">Custom Plan</h2>
                <div class="card shadow-sm" style="border-radius: 15px;">
                    <div class="card-body p-4">
                        <form method="post" class="row g-3">
                            {% csrf_token %}
                            {{ form|crispy }}
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary" style="background-color: #F3A9A8; border: none; transition: all 0.3s ease;">
                                    Create Custom Plan
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </section>

            <!-- Current Plans -->
            <section>
                <h2 class="h3 mb-4 text-primary">Your Plans</h2>
                {% if user_plans %}
                <div class="row g-4">
                    {% for plan in user_plans %}
                    <div class="col-md-4">
                        <div class="card h-100 shadow-sm" style="border-radius: 15px; transition: transform 0.3s ease;">
                            <div class="card-body text-center">
                                <h3 class="card-title mb-3" style="color: #d81b60;">{{ plan.name }}</h3>
                                {% if plan.plan_type == '5:2' %}
                                    <p class="card-text mb-2">{{ plan.fasting_days }} Days Fasting</p>
                                    <p class="card-text mb-3">{{ plan.eating_days }} Days Eating</p>
                                {% else %}
                                    <p class="card-text mb-2">{{ plan.fasting_hours }} Hours Fasting</p>
                                    <p class="card-text mb-3">{{ plan.eating_hours }} Hours Eating</p>
                                {% endif %}
                                <form method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="select_plan" value="{{ plan.id }}">
                                    <button class="btn btn-primary w-100" style="background-color: #F3A9A8; border: none; transition: all 0.3s ease;">Select</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-center text-muted fst-italic">No custom plans yet. Create one above!</p>
                {% endif %}
            </section>
        </div>
    </div>
</div>
{% endblock %}
